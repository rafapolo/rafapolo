<html>
<head>
	<title>StoryScreen</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
	<meta name="description" content="Descreva um cenário e as imagens aparecerão direto do flickr!"/>
	<meta name="author" content="Rafael Polo"/>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-language" content="pt" />
	<style>
		body {background-color: black; font-size:16px; font-family:tahoma;}
		img {position:absolute; display:none; cursor:move;}
		p.label {color:red; background:black; position:absolute;}
		input {font-size:15px; font-family:tahoma;}
		#cenario {font-size:15px; border-width:1px; border-style:solid; border-color:gray; color:white; background-color:black;}
	</style>
</head>

<body>
	<p style="color:white" align="center">Describe a scene: <input id="cenario" type="text" size="100"/><input id="limpar" type="button" value="clean"/></p>
	<div id ="images"></div>

	<script>
	$(function(){
		var imgs = new Array();
		var getImage = function(name){
		$.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?tags="+name+"&tagmode=any&format=json&jsoncallback=?",
			function(data){
				src = data.items[0].media.m;
				if (src){
					$("<div/>").attr("id", "img-"+name).appendTo("#images");
					$("<img/>").attr("id", name).attr("src", src).load(function(){
						var width = this.width;
						var height = this.width;
						var randomLeft = Math.round(Math.random()*(window.innerWidth - width-10));
						var randomTop = Math.round(Math.random()*(window.innerHeight - height-50))+50;
						var divImg = $("#img-"+name);
						$(this).css("left", randomLeft).css("top", randomTop).appendTo(divImg);
						$("<p/>").addClass("label").css("left", randomLeft).css("top", randomTop-20).appendTo(divImg).append("["+name+"]");
						$(this).fadeIn();
						//$(this).appendTo("#img-"+name);
						divImg.draggable();
					});
				}
			});
		}

		$("#limpar").click(function(){
			imgs = [];
			$("#images").empty();
			$("#cenario").val("");
			$("#cenario").focus();
		});

		$("#cenario").bind('keyup', function(e) {
		   var key = (e.keyCode ? e.keyCode : e.charCode);
			// espaço, ponto ou enter.
		  	if ((key == '32') || (key == '190') || (key == '13')) {
		  		var palavras = $("#cenario").val().replace(/\./g,"").split(" ");
				$.each(palavras, function(){
					palavra = this+"";
					if ((palavra.length>=3) && ($.inArray(palavra, imgs) == -1)){
						imgs.push(palavra);
						getImage(palavra);
					}
				});
		  	}
		});

		$("#cenario").focus();
	});
	</script>

</body>

</html>
